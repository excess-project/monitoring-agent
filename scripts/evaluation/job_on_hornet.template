#!/bin/bash

#PBS -l walltime=00:60:00
##PBS -lmppwidth=USER_JOB_WIDTH
#PBS -l nodes=USER_PBS_NODES:ppn=20
#PBS -q night
#PBS -M hpcdkhab@hlrs.de
#PBS -N USER_JOB_NAME
#PBS -o USER_PROJ_DIR/messages/${PBS_JOBID}.out
#PBS -e USER_PROJ_DIR/messages/${PBS_JOBID}.err

#procs: 16(192 procs)-PBS 1536
#procs: 15(144 procs)-PBS 1152
#procs: 14(128 procs)-PBS 1024
#procs: 13(96 procs)-PBS  768
#procs: 12(64 procs)-PBS  512
#procs: 11(48 procs)-PBS  384
#procs: 10(36 procs)-PBS  288

PROC_START=USER_PROC_START
PROC_END=USER_PROC_END
CORE_START=USER_CORE_START
CORE_END=USER_CORE_END
SIZE_START=USER_SIZE_START
SIZE_END=USER_SIZE_END
PERF_NEW=USER_PERF_NEW
MV_ALGORITHM=USER_MV_ALGORITHM
MV_COMMUNICATOR=USER_MV_COMMUNICATOR
matrix_scaler=user_matrix_scaler
preconditioner=user_preconditioner
mv_algorithm_off_diag=user_mv_algorithm_off_diag
echo "JOB MV_ALGORITH="$MV_ALGORITHM
echo "JOB MV_COMMUNICATOR="$MV_COMMUNICATOR

BENCHMARK=USER_BENCHMARK
PREFIX="USER_PREFIX"
#procs
PROJ_DIR=USER_PROJ_DIR
LUSTRE_DIR=USER_LUSTRE_DIR
PERF_FILE=USER_PERF_FILE
PROF_FILE=USER_PROF_FILE

RUN_SCRIPT_NAME=USER_RUN_SCRIPT_NAME
export CRAY_OMP_CHECK_AFFINITY=FALSE



hostname
echo "get unique key for the Excess monitoring framework"
module load power/mf_shared
DBKEY=$( get_unique_dbkey -d ${HOME}/.mf/dbkey/ -f ${PBS_JOBID} )
echo "my unique key for the database monitoring framework is:" $DBKEY

#1PREFIX;2SIZE_START;3SIZE_END;4PROCS_START;5PROCS_END;6PERF_NEW;7MV_ALGORITHM_ID;8MV_COMMUNICATOR_ID;9BENCH$
bash -x ${RUN_SCRIPT_NAME} "${PREFIX}" "${SIZE_START}" "${SIZE_END}" "${PROC_START}" "${PROC_END}" "${PERF_N$

